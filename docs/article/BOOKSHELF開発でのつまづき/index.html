<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>memo</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/memo/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/memo/_nuxt/86f38c3.js" as="script"><link rel="preload" href="/memo/_nuxt/12bbf66.js" as="script"><link rel="preload" href="/memo/_nuxt/e5ab36a.js" as="script"><link rel="preload" href="/memo/_nuxt/fa5cec4.js" as="script"><link rel="preload" href="/memo/_nuxt/9d26a97.js" as="script"><style data-vue-ssr-id="e622d370:0 517a8dd7:0 6439d180:0">body{background-color:#eceff1;color:#546e7a;font-family:"Hiragino Kaku Gothic Pro",Meiryo,sans-serif;margin:16px}h1{font-size:36px;font-weight:700}h2{position:relative;padding:.5em;background:#546e7a;color:#fff}h2:before{position:absolute;content:"";top:100%;left:0;border:none;border-right:20px solid #959e9b;border-bottom:15px solid transparent}h3{font-size:20px;border-left:3px solid #546e7a;padding:.25em .5em;background:#cfd8dc}h3,h4{font-weight:700;margin:40px 0 10px}h4{border-bottom:5px double #546e7a;font-size:18px;padding:0 0 0 10px}h5{font-size:16px;margin:40px 0 10px;font-weight:700}em{background:linear-gradient(transparent 80%,#fff59d 0);font-style:normal}em,strong{padding:0 5px}strong{background:linear-gradient(transparent,#fff59d 0)}code,strong{border-radius:5px}code{display:inline-block;padding:.1em .25em;color:#263238;background-color:transparent;font-family:"ヒラギノ角ゴシック","メイリオ",sans-serif;font-size:14px}pre{padding:.5em 1em;margin:1em 0;color:#e7edf3;background-color:#eceff1;border-left:6px solid #546e7a;box-shadow:0 2px 3px rgba(0,0,0,.33)}table{border-collapse:collapse;border:1px solid #b0bec5;line-height:1.5;margin:10px 0;width:100%}table th{font-weight:700;text-align:left;background:#cfd8dc}table td,table th{padding:10px;font-size:12px;vertical-align:top;border:1px solid #b0bec5}.idx{font-size:24px;padding:8px;margin:8px}a,a:visited{color:#546e7a}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><article><a href="/memo/" class="nuxt-link-active"> 一覧へ </a> <div class="nuxt-content"><h1 id="bookshelf-開発でのつまづき"><a href="#bookshelf-%E9%96%8B%E7%99%BA%E3%81%A7%E3%81%AE%E3%81%A4%E3%81%BE%E3%81%A5%E3%81%8D" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>BOOKSHELF 開発でのつまづき</h1>
<h3 id="db-を使わずにデータを保持する"><a href="#db-%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%9A%E3%81%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%BF%9D%E6%8C%81%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>DB を使わずにデータを保持する</h3>
<h4 id="やりたかったこと"><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>やりたかったこと</h4>
<ul>
<li>DB を利用しない（将来的に個人情報の入ったデータを扱いたくなった場合、DB にデータを保持したくない）</li>
<li>一度データを登録したらアクセスし直した時も保持したままでいてほしい</li>
<li>検索結果や登録途中のデータは一時的な保持で OK</li>
<li>別デバイスで利用する際、データを共有したい</li>
</ul>
<h4 id="実現方法"><a href="#%E5%AE%9F%E7%8F%BE%E6%96%B9%E6%B3%95" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>実現方法</h4>
<ul>
<li>
<p>localStorage、Store、csv ファイルの組み合わせ</p>

























<table><thead><tr><th>保存場所</th><th>保存したいもの</th><th>具体的な保存内容</th></tr></thead><tbody><tr><td>localStorage</td><td>一度入力したらずっと保持してほしいデータ<br>セキュリティ上の責任から、ローカルに保持したいデータ</td><td>バックアップデータの保存先 URL（保存先をクラウドにするとなったら必要）<br>登録済の書籍情報</td></tr><tr><td>Store</td><td>一時的に保持したいデータ<br>リロードしたら消えて OK なデータ</td><td>書影 API からの検索結果<br>捜査対象の書籍情報</td></tr><tr><td>csv ファイル</td><td>人と共有したいデータ<br>異なるデバイス間で共有したいデータ</td><td>登録済みの書籍情報</td></tr></tbody></table>
</li>
<li>
<p>csv ファイルを、URL さえ分かればアクセス可能なクラウドにエクスポートし、それを参照する形としたいが、現在実装保留</p>
</li>
</ul>
<h3 id="選択したファイルの中身を取り出す"><a href="#%E9%81%B8%E6%8A%9E%E3%81%97%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>選択したファイルの中身を取り出す</h3>
<h4 id="発生事案"><a href="#%E7%99%BA%E7%94%9F%E4%BA%8B%E6%A1%88" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>発生事案</h4>
<p>以下コードで reader.result が null になる</p>
<div class="nuxt-content-highlight"><pre class="language-text line-numbers"><code>selectFile(event) {
  let result = event.target.files[0];
  let reader = new FileReader();
  reader.readAsText(result);
  this.file = reader.result;
},
</code></pre></div>
<h4 id="原因"><a href="#%E5%8E%9F%E5%9B%A0" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>原因</h4>
<ul>
<li>readAsText は非同期処理のため、読み取り中に読み取り結果にアクセスしようとして null になっていた</li>
</ul>
<h4 id="解決方法"><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>解決方法</h4>
<ul>
<li>reader.onload の中に、読み取り後の処理を書く</li>
</ul>
<div class="nuxt-content-highlight"><pre class="language-text line-numbers"><code>selectFile(event) {
  let result = event.target.files[0];
  let reader = new FileReader();
  reader.readAsText(result);
  reader.onload = () => {
    this.file = reader.result;
  };
},
</code></pre></div>
<h3 id="データを-csv-データに変換する"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92-csv-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>データを csv データに変換する</h3>
<h4 id="前提"><a href="#%E5%89%8D%E6%8F%90" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>前提</h4>
<p>元データは、オブジェクトの配列</p>
<div class="nuxt-content-highlight"><pre class="language-text line-numbers"><code>items = [
  {
    id:"1",
    image:"サムネ画像のURL",
    isbn:"isbnコード",
    title:"本のタイトル",
    type:"紙"
  },
  {
    id:"2",
    image:"サムネ画像のURL",
    isbn:"isbnコード",
    title:"本のタイトル",
    type:"電子"
  },
  ...
]
</code></pre></div>
<h4 id="利用メソッド"><a href="#%E5%88%A9%E7%94%A8%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>利用メソッド</h4>
<ul>
<li>Object.keys()
<ul>
<li>指定されたオブジェクトが持つプロパティの 名前の配列を、通常のループで取得するのと同じ順序で返す</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/keys" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/keys</a></li>
</ul>
</li>
<li>.join()
<ul>
<li>配列（または配列風オブジェクト）の全要素を順に連結した文字列を新たに作成して返す</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/join" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/join</a></li>
</ul>
</li>
<li>Null 合体演算子 (??)
<ul>
<li>左辺が null または undefined の場合に右の値を返し、それ以外の場合に左の値を返す</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing</a></li>
</ul>
</li>
<li>JSON.stringify()
<ul>
<li>JavaScript のオブジェクトや値を JSON 文字列に変換する</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#replacer_%E3%81%A8%E3%81%97%E3%81%A6%E9%96%A2%E6%95%B0%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B%E4%BE%8B" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#replacer_%E3%81%A8%E3%81%97%E3%81%A6%E9%96%A2%E6%95%B0%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B%E4%BE%8B</a></li>
</ul>
</li>
<li>スプレッド構文（...）
<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Spread_syntax</a></li>
</ul>
</li>
<li>Blob()
<ul>
<li>引数で与えられた配列から Blob オブジェクトを返す</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/Blob/Blob" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/API/Blob/Blob</a></li>
</ul>
</li>
<li>Document.createElement()
<ul>
<li>指定された HTML 要素を生成する</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/Document/createElement" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/API/Document/createElement</a></li>
</ul>
</li>
<li>URL.createObjectURL()
<ul>
<li>引数で指定されたオブジェクトを表す URL を含む DOMString を生成する</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/URL/createObjectURL" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/API/URL/createObjectURL</a></li>
</ul>
</li>
<li>.download()
<ul>
<li>download 属性が設定された a タグをクリックした場合、ブラウザはユーザーをそのコンテンツのページにナビゲートするのではなく、 コンテンツをファイルに保存する</li>
<li>HTML5 からの機能</li>
<li><a href="https://javascript.keicode.com/newjs/download-files.php" rel="nofollow noopener noreferrer" target="_blank">https://javascript.keicode.com/newjs/download-files.php</a></li>
</ul>
</li>
<li>HTMLElement.click()
<ul>
<li>要素のマウスクリックをシミュレートする</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/HTMLElement/click" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/API/HTMLElement/click</a></li>
</ul>
</li>
<li>Element.remove()
<ul>
<li>所属するツリーから要素を削除する</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/Element/remove" rel="nofollow noopener noreferrer" target="_blank">https://developer.mozilla.org/ja/docs/Web/API/Element/remove</a></li>
</ul>
</li>
</ul>
<h4 id="実装"><a href="#%E5%AE%9F%E8%A3%85" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>実装</h4>
<div class="nuxt-content-highlight"><pre class="language-text line-numbers"><code>// 配列の1つ目の要素を取り出し、そのkeyを取得
const header = Object.keys(items[0]);
// ['id', 'title', 'isbn', 'image', 'type']

// header行を文字列化する
const headerString = header.join(",");
// id,title,isbn,image,type

// key,valueを受け取り、valueに該当する値を返す関数を定義
const replacer = (key, value) => value ?? "";

// header行以外のデータを文字列化する
const rowItems = items.map((row) =>
  header.map((fieldName) => JSON.stringify(row[fieldName], replacer))
  .join(",")
);

// headerとコンテンツ部分を結合する
const csv = [headerString, ...rowItems].join("\r\n");

// BOM付UTF-8にすることで文字化けを防ぐ
const bom = new Uint8Array([0xef, 0xbb, 0xbf]);

// 配列をBlobオブジェクトに変換する
const blob = new Blob([bom, csv], {
  type: "text/csv",
});

// csvファイルを生成し、ダウンロードする
// aタグを生成する
const link = document.createElement("a");
// 生成したaタグのhref属性に、生成したBlobオブジェクトを表すURLを設定する
link.href = URL.createObjectURL(blob);
// a要素にdownload属性を設定する
link.download = "books.csv";
// a要素をclickした時の動作を再現する
link.click();
// DOMツリーから要素を削除する
link.remove();
</code></pre></div>
<h3 id="csv-で配列の中に配列がある場合にうまく-json-化できない"><a href="#csv-%E3%81%A7%E9%85%8D%E5%88%97%E3%81%AE%E4%B8%AD%E3%81%AB%E9%85%8D%E5%88%97%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AB%E3%81%86%E3%81%BE%E3%81%8F-json-%E5%8C%96%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>csv で、配列の中に配列がある場合に、うまく json 化できない</h3>
<ul>
<li>区切り文字が、[]内の区切り文字も認識されてしまう。</li>
<li>無視したいができない</li>
<li>ひとまず、元データのほうを１次元配列になるよう修正</li>
</ul>
<h3 id="localstorage-と-store-間のデータ受け渡し"><a href="#localstorage-%E3%81%A8-store-%E9%96%93%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%97%E3%81%91%E6%B8%A1%E3%81%97" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>localStorage と Store 間のデータ受け渡し</h3>
<ul>
<li>localSrorage はすべてのデータを文字列化して保存しているため、オブジェクトをそのまま保存することができない</li>
</ul>
<h4 id="localstorage-のデータを-json-化する"><a href="#localstorage-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92-json-%E5%8C%96%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>localStorage のデータを json 化する</h4>
<div class="nuxt-content-highlight"><pre class="language-text line-numbers"><code>JSON.parse(localStorage.getItem("key名"));
</code></pre></div>
<h4 id="オブジェクト-を-文字列化する"><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88-%E3%82%92-%E6%96%87%E5%AD%97%E5%88%97%E5%8C%96%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>オブジェクト を 文字列化する</h4>
<div class="nuxt-content-highlight"><pre class="language-text line-numbers"><code>JSON.stringify(data);
</code></pre></div>
<h3 id="nuxt-アプリを-netlify-で公開する"><a href="#nuxt-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92-netlify-%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Nuxt アプリを Netlify で公開する</h3>
<h4 id="参考サイト"><a href="#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>参考サイト</h4>
<p><a href="https://zenn.dev/shu00011/articles/0e5937ca1ff85b" rel="nofollow noopener noreferrer" target="_blank">https://zenn.dev/shu00011/articles/0e5937ca1ff85b</a></p>
<h4 id="dist-フォルダを-git-管理の対象にする"><a href="#dist-%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%82%92-git-%E7%AE%A1%E7%90%86%E3%81%AE%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>dist フォルダを git 管理の対象にする</h4>
<ul>
<li>上記参考サイトの通り進めたが、ビルドに失敗した</li>
<li>エラーを確認したところ、dist フォルダがないと言われている</li>
<li>dist フォルダは git の管理対象外となっていたため、変更が反映されていなかった</li>
<li>.gitignore ファイルから dist を消して commit と push をした後、retry することで解消</li>
</ul></div></article></div></div><script>window.__NUXT__=function(e,t,p,a,l,r,n,y,s,d,i,o,c,h,v,u,g,E,A,m,B,b,f,N,x,F,j,O,S,H,I,k,L,R,D,w,U,_,J,z,C,T,W,P,M,K,G,Z,X,q,Q,V,Y,$,ee,te){return{layout:"default",data:[{page:{slug:"BOOKSHELF開発でのつまづき",toc:[{id:H,depth:3,text:I},{id:j,depth:3,text:j},{id:k,depth:3,text:L},{id:R,depth:3,text:D},{id:w,depth:3,text:U},{id:_,depth:3,text:J}],body:{type:"root",children:[{type:t,tag:"h1",props:{id:"bookshelf-開発でのつまづき"},children:[{type:t,tag:l,props:{href:"#bookshelf-%E9%96%8B%E7%99%BA%E3%81%A7%E3%81%AE%E3%81%A4%E3%81%BE%E3%81%A5%E3%81%8D",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"BOOKSHELF 開発でのつまづき"}]},{type:e,value:p},{type:t,tag:E,props:{id:H},children:[{type:t,tag:l,props:{href:"#db-%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%9A%E3%81%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%BF%9D%E6%8C%81%E3%81%99%E3%82%8B",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:I}]},{type:e,value:p},{type:t,tag:o,props:{id:z},children:[{type:t,tag:l,props:{href:"#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:z}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"DB を利用しない（将来的に個人情報の入ったデータを扱いたくなった場合、DB にデータを保持したくない）"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"一度データを登録したらアクセスし直した時も保持したままでいてほしい"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"検索結果や登録途中のデータは一時的な保持で OK"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"別デバイスで利用する際、データを共有したい"}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:o,props:{id:C},children:[{type:t,tag:l,props:{href:"#%E5%AE%9F%E7%8F%BE%E6%96%B9%E6%B3%95",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:C}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:p},{type:t,tag:x,props:{},children:[{type:e,value:"localStorage、Store、csv ファイルの組み合わせ"}]},{type:e,value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:t,tag:"table",props:{},children:[{type:t,tag:"thead",props:{},children:[{type:t,tag:O,props:{},children:[{type:t,tag:S,props:{},children:[{type:e,value:"保存場所"}]},{type:t,tag:S,props:{},children:[{type:e,value:"保存したいもの"}]},{type:t,tag:S,props:{},children:[{type:e,value:"具体的な保存内容"}]}]}]},{type:t,tag:"tbody",props:{},children:[{type:t,tag:O,props:{},children:[{type:t,tag:g,props:{},children:[{type:e,value:"localStorage"}]},{type:t,tag:g,props:{},children:[{type:e,value:"一度入力したらずっと保持してほしいデータ"},{type:t,tag:F,props:{},children:[]},{type:e,value:"セキュリティ上の責任から、ローカルに保持したいデータ"}]},{type:t,tag:g,props:{},children:[{type:e,value:"バックアップデータの保存先 URL（保存先をクラウドにするとなったら必要）"},{type:t,tag:F,props:{},children:[]},{type:e,value:"登録済の書籍情報"}]}]},{type:t,tag:O,props:{},children:[{type:t,tag:g,props:{},children:[{type:e,value:"Store"}]},{type:t,tag:g,props:{},children:[{type:e,value:"一時的に保持したいデータ"},{type:t,tag:F,props:{},children:[]},{type:e,value:"リロードしたら消えて OK なデータ"}]},{type:t,tag:g,props:{},children:[{type:e,value:"書影 API からの検索結果"},{type:t,tag:F,props:{},children:[]},{type:e,value:"捜査対象の書籍情報"}]}]},{type:t,tag:O,props:{},children:[{type:t,tag:g,props:{},children:[{type:e,value:"csv ファイル"}]},{type:t,tag:g,props:{},children:[{type:e,value:"人と共有したいデータ"},{type:t,tag:F,props:{},children:[]},{type:e,value:"異なるデバイス間で共有したいデータ"}]},{type:t,tag:g,props:{},children:[{type:e,value:"登録済みの書籍情報"}]}]}]}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:p},{type:t,tag:x,props:{},children:[{type:e,value:"csv ファイルを、URL さえ分かればアクセス可能なクラウドにエクスポートし、それを参照する形としたいが、現在実装保留"}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:E,props:{id:j},children:[{type:t,tag:l,props:{href:"#%E9%81%B8%E6%8A%9E%E3%81%97%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:j}]},{type:e,value:p},{type:t,tag:o,props:{id:T},children:[{type:t,tag:l,props:{href:"#%E7%99%BA%E7%94%9F%E4%BA%8B%E6%A1%88",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:T}]},{type:e,value:p},{type:t,tag:x,props:{},children:[{type:e,value:"以下コードで reader.result が null になる"}]},{type:e,value:p},{type:t,tag:A,props:{className:[m]},children:[{type:t,tag:B,props:{className:[b,f]},children:[{type:t,tag:N,props:{},children:[{type:e,value:"selectFile(event) {\n  let result = event.target.files[0];\n  let reader = new FileReader();\n  reader.readAsText(result);\n  this.file = reader.result;\n},\n"}]}]}]},{type:e,value:p},{type:t,tag:o,props:{id:"原因"},children:[{type:t,tag:l,props:{href:"#%E5%8E%9F%E5%9B%A0",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"原因"}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"readAsText は非同期処理のため、読み取り中に読み取り結果にアクセスしようとして null になっていた"}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:o,props:{id:W},children:[{type:t,tag:l,props:{href:"#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:W}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"reader.onload の中に、読み取り後の処理を書く"}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:A,props:{className:[m]},children:[{type:t,tag:B,props:{className:[b,f]},children:[{type:t,tag:N,props:{},children:[{type:e,value:"selectFile(event) {\n  let result = event.target.files[0];\n  let reader = new FileReader();\n  reader.readAsText(result);\n  reader.onload = () => {\n    this.file = reader.result;\n  };\n},\n"}]}]}]},{type:e,value:p},{type:t,tag:E,props:{id:k},children:[{type:t,tag:l,props:{href:"#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92-csv-%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:L}]},{type:e,value:p},{type:t,tag:o,props:{id:"前提"},children:[{type:t,tag:l,props:{href:"#%E5%89%8D%E6%8F%90",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"前提"}]},{type:e,value:p},{type:t,tag:x,props:{},children:[{type:e,value:"元データは、オブジェクトの配列"}]},{type:e,value:p},{type:t,tag:A,props:{className:[m]},children:[{type:t,tag:B,props:{className:[b,f]},children:[{type:t,tag:N,props:{},children:[{type:e,value:'items = [\n  {\n    id:"1",\n    image:"サムネ画像のURL",\n    isbn:"isbnコード",\n    title:"本のタイトル",\n    type:"紙"\n  },\n  {\n    id:"2",\n    image:"サムネ画像のURL",\n    isbn:"isbnコード",\n    title:"本のタイトル",\n    type:"電子"\n  },\n  ...\n]\n'}]}]}]},{type:e,value:p},{type:t,tag:o,props:{id:P},children:[{type:t,tag:l,props:{href:"#%E5%88%A9%E7%94%A8%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:P}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"Object.keys()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"指定されたオブジェクトが持つプロパティの 名前の配列を、通常のループで取得するのと同じ順序で返す"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:M,rel:[c,h,v],target:u},children:[{type:e,value:M}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:".join()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"配列（または配列風オブジェクト）の全要素を順に連結した文字列を新たに作成して返す"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:K,rel:[c,h,v],target:u},children:[{type:e,value:K}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"Null 合体演算子 (??)\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"左辺が null または undefined の場合に右の値を返し、それ以外の場合に左の値を返す"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:G,rel:[c,h,v],target:u},children:[{type:e,value:G}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"JSON.stringify()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"JavaScript のオブジェクトや値を JSON 文字列に変換する"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:Z,rel:[c,h,v],target:u},children:[{type:e,value:Z}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"スプレッド構文（...）\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:X,rel:[c,h,v],target:u},children:[{type:e,value:X}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"Blob()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"引数で与えられた配列から Blob オブジェクトを返す"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:q,rel:[c,h,v],target:u},children:[{type:e,value:q}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"Document.createElement()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"指定された HTML 要素を生成する"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:Q,rel:[c,h,v],target:u},children:[{type:e,value:Q}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"URL.createObjectURL()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"引数で指定されたオブジェクトを表す URL を含む DOMString を生成する"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:V,rel:[c,h,v],target:u},children:[{type:e,value:V}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:".download()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"download 属性が設定された a タグをクリックした場合、ブラウザはユーザーをそのコンテンツのページにナビゲートするのではなく、 コンテンツをファイルに保存する"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"HTML5 からの機能"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:Y,rel:[c,h,v],target:u},children:[{type:e,value:Y}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"HTMLElement.click()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"要素のマウスクリックをシミュレートする"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:$,rel:[c,h,v],target:u},children:[{type:e,value:$}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"Element.remove()\n"},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"所属するツリーから要素を削除する"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:t,tag:l,props:{href:ee,rel:[c,h,v],target:u},children:[{type:e,value:ee}]}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:o,props:{id:"実装"},children:[{type:t,tag:l,props:{href:"#%E5%AE%9F%E8%A3%85",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"実装"}]},{type:e,value:p},{type:t,tag:A,props:{className:[m]},children:[{type:t,tag:B,props:{className:[b,f]},children:[{type:t,tag:N,props:{},children:[{type:e,value:'// 配列の1つ目の要素を取り出し、そのkeyを取得\nconst header = Object.keys(items[0]);\n// [\'id\', \'title\', \'isbn\', \'image\', \'type\']\n\n// header行を文字列化する\nconst headerString = header.join(",");\n// id,title,isbn,image,type\n\n// key,valueを受け取り、valueに該当する値を返す関数を定義\nconst replacer = (key, value) => value ?? "";\n\n// header行以外のデータを文字列化する\nconst rowItems = items.map((row) =>\n  header.map((fieldName) => JSON.stringify(row[fieldName], replacer))\n  .join(",")\n);\n\n// headerとコンテンツ部分を結合する\nconst csv = [headerString, ...rowItems].join("\\r\\n");\n\n// BOM付UTF-8にすることで文字化けを防ぐ\nconst bom = new Uint8Array([0xef, 0xbb, 0xbf]);\n\n// 配列をBlobオブジェクトに変換する\nconst blob = new Blob([bom, csv], {\n  type: "text/csv",\n});\n\n// csvファイルを生成し、ダウンロードする\n// aタグを生成する\nconst link = document.createElement("a");\n// 生成したaタグのhref属性に、生成したBlobオブジェクトを表すURLを設定する\nlink.href = URL.createObjectURL(blob);\n// a要素にdownload属性を設定する\nlink.download = "books.csv";\n// a要素をclickした時の動作を再現する\nlink.click();\n// DOMツリーから要素を削除する\nlink.remove();\n'}]}]}]},{type:e,value:p},{type:t,tag:E,props:{id:R},children:[{type:t,tag:l,props:{href:"#csv-%E3%81%A7%E9%85%8D%E5%88%97%E3%81%AE%E4%B8%AD%E3%81%AB%E9%85%8D%E5%88%97%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AB%E3%81%86%E3%81%BE%E3%81%8F-json-%E5%8C%96%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:D}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"区切り文字が、[]内の区切り文字も認識されてしまう。"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"無視したいができない"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"ひとまず、元データのほうを１次元配列になるよう修正"}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:E,props:{id:w},children:[{type:t,tag:l,props:{href:"#localstorage-%E3%81%A8-store-%E9%96%93%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%97%E3%81%91%E6%B8%A1%E3%81%97",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:U}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"localSrorage はすべてのデータを文字列化して保存しているため、オブジェクトをそのまま保存することができない"}]},{type:e,value:p}]},{type:e,value:p},{type:t,tag:o,props:{id:"localstorage-のデータを-json-化する"},children:[{type:t,tag:l,props:{href:"#localstorage-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92-json-%E5%8C%96%E3%81%99%E3%82%8B",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"localStorage のデータを json 化する"}]},{type:e,value:p},{type:t,tag:A,props:{className:[m]},children:[{type:t,tag:B,props:{className:[b,f]},children:[{type:t,tag:N,props:{},children:[{type:e,value:'JSON.parse(localStorage.getItem("key名"));\n'}]}]}]},{type:e,value:p},{type:t,tag:o,props:{id:"オブジェクト-を-文字列化する"},children:[{type:t,tag:l,props:{href:"#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88-%E3%82%92-%E6%96%87%E5%AD%97%E5%88%97%E5%8C%96%E3%81%99%E3%82%8B",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"オブジェクト を 文字列化する"}]},{type:e,value:p},{type:t,tag:A,props:{className:[m]},children:[{type:t,tag:B,props:{className:[b,f]},children:[{type:t,tag:N,props:{},children:[{type:e,value:"JSON.stringify(data);\n"}]}]}]},{type:e,value:p},{type:t,tag:E,props:{id:_},children:[{type:t,tag:l,props:{href:"#nuxt-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92-netlify-%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%99%E3%82%8B",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:J}]},{type:e,value:p},{type:t,tag:o,props:{id:"参考サイト"},children:[{type:t,tag:l,props:{href:"#%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"参考サイト"}]},{type:e,value:p},{type:t,tag:x,props:{},children:[{type:t,tag:l,props:{href:te,rel:[c,h,v],target:u},children:[{type:e,value:te}]}]},{type:e,value:p},{type:t,tag:o,props:{id:"dist-フォルダを-git-管理の対象にする"},children:[{type:t,tag:l,props:{href:"#dist-%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%82%92-git-%E7%AE%A1%E7%90%86%E3%81%AE%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%99%E3%82%8B",ariaHidden:r,tabIndex:n},children:[{type:t,tag:y,props:{className:[s,d]},children:[]}]},{type:e,value:"dist フォルダを git 管理の対象にする"}]},{type:e,value:p},{type:t,tag:i,props:{},children:[{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"上記参考サイトの通り進めたが、ビルドに失敗した"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"エラーを確認したところ、dist フォルダがないと言われている"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:"dist フォルダは git の管理対象外となっていたため、変更が反映されていなかった"}]},{type:e,value:p},{type:t,tag:a,props:{},children:[{type:e,value:".gitignore ファイルから dist を消して commit と push をした後、retry することで解消"}]},{type:e,value:p}]}]},dir:"/article",path:"/article/BOOKSHELF開発でのつまづき",extension:".md",createdAt:"2023-04-06T13:39:50.916Z",updatedAt:"2023-04-11T01:01:42.283Z"}}],fetch:{},error:null,serverRendered:!0,routePath:"/article/BOOKSHELF%E9%96%8B%E7%99%BA%E3%81%A7%E3%81%AE%E3%81%A4%E3%81%BE%E3%81%A5%E3%81%8D",config:{_app:{basePath:"/memo/",assetsPath:"/memo/_nuxt/",cdnURL:null},content:{dbHash:"6740526c"}}}}("text","element","\n","li","a","true",-1,"span","icon","icon-link","ul","h4","nofollow","noopener","noreferrer","_blank","td","h3","div","nuxt-content-highlight","pre","language-text","line-numbers","code","p","br","選択したファイルの中身を取り出す","tr","th","db-を使わずにデータを保持する","DB を使わずにデータを保持する","データを-csv-データに変換する","データを csv データに変換する","csv-で配列の中に配列がある場合にうまく-json-化できない","csv で、配列の中に配列がある場合に、うまく json 化できない","localstorage-と-store-間のデータ受け渡し","localStorage と Store 間のデータ受け渡し","nuxt-アプリを-netlify-で公開する","Nuxt アプリを Netlify で公開する","やりたかったこと","実現方法","発生事案","解決方法","利用メソッド","https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/keys","https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/join","https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing","https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#replacer_%E3%81%A8%E3%81%97%E3%81%A6%E9%96%A2%E6%95%B0%E3%82%92%E7%94%A8%E3%81%84%E3%82%8B%E4%BE%8B","https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Spread_syntax","https://developer.mozilla.org/ja/docs/Web/API/Blob/Blob","https://developer.mozilla.org/ja/docs/Web/API/Document/createElement","https://developer.mozilla.org/ja/docs/Web/API/URL/createObjectURL","https://javascript.keicode.com/newjs/download-files.php","https://developer.mozilla.org/ja/docs/Web/API/HTMLElement/click","https://developer.mozilla.org/ja/docs/Web/API/Element/remove","https://zenn.dev/shu00011/articles/0e5937ca1ff85b")</script><script src="/memo/_nuxt/86f38c3.js" defer></script><script src="/memo/_nuxt/9d26a97.js" defer></script><script src="/memo/_nuxt/12bbf66.js" defer></script><script src="/memo/_nuxt/e5ab36a.js" defer></script><script src="/memo/_nuxt/fa5cec4.js" defer></script>
  </body>
</html>
